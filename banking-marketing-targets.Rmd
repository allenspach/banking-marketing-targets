---
title: "banking-marketing-targets"
author: "Victor"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

# 0- Starting point

## 0.1- Installing packages

```{r}
install.packages("tidyverse")
```

# 1- Importing packages

```{r}
library(tidyverse)
```

# 2- Data loading

```{r}
# Lendo base de dados
df <- read_delim("test.csv")
```

```{r}
# Visualizando os dados
df %>% View
```

```{r}
View(df)
```

```{r}
df %>% glimpse
```

```{r}
# Visualizando as n primeiras linhas
df %>% head(3)
```

```{r}
# Data type
tibble(features=colnames(df), data_type=unlist(lapply(df,typeof)))
```

```{r}
# Data dimension
tibble(dimension=unlist(list("rows", "columns")),count=c(dim(df)[1],dim(df)[2]))
```

```{r}
# Sum of NANs
tibble(variable=colnames(df), number_of_missing=colSums(is.na(df)))
```

```{r}
# Sum of NANs
tibble(variable=df %>% colnames,
       number_of_missing = df %>% is.na %>% colSums)
```

```{r}
#Rename of columns, encoding of binary features, remove other from poutcome
##
df %>%
  
  rename( # new names
         has_credit=default,
         last_contact=day,
         housing_loan=housing,
         response=y) %>%
  
  mutate( # binary logic
         response=ifelse(response=="yes",1,0),
         housing_loan=ifelse(housing_loan=="yes",1,0),
         loan=ifelse(loan=="yes",1,0),
         has_credit=ifelse(has_credit=="yes",1,0),
         marital=ifelse(marital=="married",1,0),
         employed=ifelse(job=="unemployed",0,1),
         
         poutcome=case_when( # change unknown for failure
                            poutcome=="unknown" ~ "failure",
                            poutcome=="failure" ~ "failure",
                            poutcome=="other" ~ "other",
                            poutcome=="success" ~ "success",),
         
         contact=case_when( # change unknown for others
                            contact=="unknown" ~ "others",
                            contact=="cellular" ~ "cellular",
                            contact=="telephone" ~ "telephone",),
         
         month=case_when( # change names for numbers
                         month=="jan" ~ 1,
                         month=="feb" ~ 2,
                         month=="mar" ~ 3,
                         month=="apr" ~ 4,
                         month=="may" ~ 5,
                         month=="jun" ~ 6,
                         month=="jul" ~ 7,
                         month=="aug" ~ 8,
                         month=="sep" ~ 9,
                         month=="oct" ~ 10,
                         month=="nov" ~ 11,
                         month=="dez" ~ 12,)) %>%
  
  filter( # remove others from poutcome
          poutcome!="other") %>%
  
  filter( # remove unknown from education
          education!="unknown")
```

```{r}
df %>% glimpse()
```

```{r}
df %>% select(education) %>% unique()
```

```{r}
#Rename of columns and encoding of binary features
df_teste <- df %>% 
  rename(has_credit=default,
         last_contact=day,
         response=y) %>% 
  mutate(response=ifelse(response=="yes",1,0),
         housing=ifelse(housing=="yes",1,0),
         loan=ifelse(loan=="yes",1,0),
         has_credit=ifelse(has_credit=="yes",1,0),
         marital=ifelse(marital=="married",1,0),
         poutcome=case_when(poutcome=="unknown" ~ "failure",
                            poutcome=="failure" ~ "failure",
                            poutcome=="other" ~ "other",
                            poutcome=="success" ~ "success",))

df_teste %>% 
  select(poutcome) %>% 
  count(poutcome) %>% 
  rename(contagem = n) %>% 
  mutate(prop=contagem/sum(contagem)*100) %>% 
  select(poutcome,prop)
```

```{r}
df %>% 
  select(month) %>% 
  count(month) %>% 
  rename(contagem = n) %>% 
  mutate(prop=contagem/sum(contagem)*100) %>% 
  select(month,prop)
```

# 3- EDA (Exploratory Data Analysis)

# 4- Data preparation

# 5- Machine Learning

# 6- Model evaluation

# 7- Rascunhos

-   OK Transformar o mes do ano em numeral

-   OK Coluna default, housing e loan: 1 para "yes" e 0 para "no"

-   OK Remover education = unknown (apenas 4% dos dados)

-   OK Poutcome (80% unknown mudar para failure)

-   Duration e pday (serparar em grupos)

-   Previous (se foi ou nao contatado antes da campanha 0=nao)

-   poutcome para binario (0 e 1)
